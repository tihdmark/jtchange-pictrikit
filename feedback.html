<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Feedback & Official Responses - PictriKit</title>
  <meta name="description" content="Read user feedback, feature requests, and official responses from the PictriKit team. Share your suggestions and see how we respond to community input.">
  <link rel="canonical" href="https://www.pictrikit.com/feedback.html">
  <meta property="og:title" content="User Feedback & Official Responses - PictriKit">
  <meta property="og:description" content="Community feedback and official responses from PictriKit. Share your thoughts and see our replies.">
  <meta property="og:url" content="https://www.pictrikit.com/feedback.html">
  <meta property="og:type" content="website">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "User Feedback & Official Responses",
    "description": "Community feedback, feature requests, and official responses from the PictriKit team",
    "url": "https://www.pictrikit.com/feedback.html",
    "isPartOf": {
      "@type": "WebSite",
      "name": "PictriKit",
      "url": "https://www.pictrikit.com"
    },
    "mainEntity": {
      "@type": "DiscussionForumPosting",
      "headline": "PictriKit User Feedback",
      "description": "A collection of user feedback, suggestions, and official responses from the PictriKit development team"
    }
  }
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, sans-serif; background: #f8fafc; color: #334155; line-height: 1.6; min-height: 100vh; }
    .container { max-width: 720px; margin: 0 auto; padding: 0 1rem; }
    
    /* Header */
    header { background: white; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; z-index: 50; }
    header .container { display: flex; justify-content: space-between; align-items: center; height: 64px; }
    .logo { display: flex; align-items: center; gap: 0.5rem; text-decoration: none; }
    .logo .material-icons-round { color: #007AFF; font-size: 1.75rem; }
    .logo span { font-weight: 700; font-size: 1.125rem; color: #111827; }
    .back-link { color: #6b7280; text-decoration: none; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem; }
    .back-link:hover { color: #007AFF; }
    
    /* Page Content */
    main { padding: 3rem 0 4rem; }
    h1 { font-size: 1.75rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem; }
    .page-intro { color: #4b5563; margin-bottom: 2rem; font-size: 0.9375rem; line-height: 1.7; }
    .page-header { margin-bottom: 2rem; }
    
    /* Form Section */
    .form-heading { font-size: 1.125rem; font-weight: 600; color: #374151; margin-bottom: 1rem; }
    
    /* Admin Badge */
    .admin-badge { display: inline-flex; align-items: center; gap: 0.25rem; background: #fef3c7; color: #92400e; font-size: 0.75rem; font-weight: 600; padding: 0.25rem 0.5rem; border-radius: 4px; margin-left: 0.5rem; }
    
    /* Feedback Form */
    .feedback-form { background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #e5e7eb; }
    .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem; }
    .form-textarea { width: 100%; height: 100px; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.9375rem; font-family: inherit; resize: vertical; outline: none; transition: border-color 0.2s; }
    .form-textarea:focus { border-color: #007AFF; }
    .form-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; }
    .char-count { font-size: 0.75rem; color: #9ca3af; }
    .submit-btn { padding: 0.625rem 1.25rem; background: #007AFF; color: white; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background 0.2s; }
    .submit-btn:hover { background: #0066DD; }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* Messages List */
    .feedback-list-section { margin-top: 2.5rem; }
    .messages-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .messages-title { font-size: 1.125rem; font-weight: 600; color: #374151; margin: 0; }
    .messages-count { font-size: 0.75rem; color: #9ca3af; }
    
    .message-card { background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; border: 1px solid #e5e7eb; }
    .message-card.deleted { opacity: 0.5; background: #fef2f2; }
    .message-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem; }
    .message-user { display: flex; align-items: center; gap: 0.5rem; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #007AFF, #5856D6); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 600; }
    .user-name { font-weight: 500; color: #6b7280; font-size: 0.8125rem; margin: 0; }
    .message-time { font-size: 0.75rem; color: #9ca3af; }
    .message-body { margin-bottom: 0.5rem; }
    .message-content { color: #1f2937; font-size: 0.9375rem; line-height: 1.7; margin: 0; }
    
    /* Admin Actions */
    .admin-actions { display: flex; gap: 0.5rem; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #f3f4f6; }
    .admin-btn { padding: 0.375rem 0.75rem; font-size: 0.75rem; font-weight: 500; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; transition: all 0.2s; }
    .admin-btn .material-icons-round { font-size: 14px; }
    .admin-btn.reply-btn { background: #eff6ff; color: #1d4ed8; }
    .admin-btn.reply-btn:hover { background: #dbeafe; }
    .admin-btn.delete-btn { background: #fef2f2; color: #dc2626; }
    .admin-btn.delete-btn:hover { background: #fee2e2; }
    
    /* Reply Form */
    .reply-form { margin-top: 0.75rem; padding: 0.75rem; background: #f9fafb; border-radius: 8px; }
    .reply-form textarea { width: 100%; height: 60px; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.8125rem; font-family: inherit; resize: none; outline: none; }
    .reply-form textarea:focus { border-color: #007AFF; }
    .reply-form-actions { display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 0.5rem; }
    .reply-form-actions button { padding: 0.375rem 0.75rem; font-size: 0.75rem; font-weight: 500; border-radius: 6px; cursor: pointer; }
    .reply-form-actions .cancel-btn { background: #f3f4f6; color: #6b7280; border: none; }
    .reply-form-actions .save-btn { background: #007AFF; color: white; border: none; }
    
    /* Creator Reply - Higher semantic weight */
    .reply-card { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-left: 4px solid #007AFF; margin-top: 1rem; padding: 1rem 1.25rem; border-radius: 0 8px 8px 0; }
    .reply-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.625rem; }
    .creator-badge { background: #007AFF; color: white; font-size: 0.625rem; font-weight: 700; padding: 0.1875rem 0.5rem; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.025em; }
    .reply-name { font-weight: 600; color: #0369a1; font-size: 0.875rem; margin: 0; }
    .reply-content { color: #0c4a6e; font-size: 0.9375rem; line-height: 1.7; margin: 0; }
    
    /* Empty State */
    .empty-state { text-align: center; padding: 3rem 1rem; color: #9ca3af; }
    .empty-state .material-icons-round { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
    
    /* Loading */
    .loading { text-align: center; padding: 2rem; color: #9ca3af; }
    
    /* Toast */
    .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #111827; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-size: 0.875rem; opacity: 0; transition: opacity 0.3s; z-index: 1000; }
    .toast.show { opacity: 1; }
    .toast.error { background: #dc2626; }
    
    /* Footer */
    footer { background: #111827; color: white; padding: 2rem 0; margin-top: auto; }
    footer .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
    footer a { color: #9ca3af; text-decoration: none; font-size: 0.875rem; }
    footer a:hover { color: white; }
    
    @media (max-width: 640px) {
      h1 { font-size: 1.5rem; }
      .message-header { flex-direction: column; gap: 0.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <a href="/" class="logo">
        <span class="material-icons-round">dashboard_customize</span>
        <span>PictriKit</span>
      </a>
      <a href="/app.html" class="back-link">
        <span class="material-icons-round" style="font-size:18px;">arrow_back</span>
        Back to Editor
      </a>
    </div>
  </header>

  <main>
    <div class="container">
      <header class="page-header">
        <h1>User Feedback & Official Responses<span class="admin-badge" id="admin-badge" style="display:none;"><span class="material-icons-round" style="font-size:12px;">admin_panel_settings</span>Admin Mode</span></h1>
        <p class="page-intro">This page collects feedback, suggestions, and bug reports from PictriKit users. Each message may include an official response from our team. We read every submission and respond when we can help or when updates are planned.</p>
      </header>
      
      <section class="feedback-form" aria-label="Submit your feedback">
        <h2 class="form-heading">Share Your Feedback</h2>
        <label class="form-label" for="feedback-input">Your message</label>
        <textarea class="form-textarea" id="feedback-input" placeholder="Describe your suggestion, question, or issue..." maxlength="1000"></textarea>
        <div class="form-footer">
          <span class="char-count"><span id="char-count">0</span>/1000</span>
          <button class="submit-btn" id="submit-btn">Send Feedback</button>
        </div>
      </section>
      
      <section class="feedback-list-section" aria-label="User feedback and responses">
        <header class="messages-header">
          <h2 class="messages-title">Community Feedback</h2>
          <span class="messages-count" id="messages-count"></span>
        </header>
        
        <div id="messages-list" role="feed" aria-label="Feedback messages">
          <p class="loading">Loading messages...</p>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <span style="font-size:0.875rem;color:#9ca3af;">&copy; 2026 PictriKit</span>
      <div style="display:flex;gap:1.5rem;">
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html">Terms</a>
        <a href="/contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <div class="toast" id="toast"></div>

  <script>
  (function() {
    const input = document.getElementById('feedback-input');
    const charCount = document.getElementById('char-count');
    const submitBtn = document.getElementById('submit-btn');
    const messagesList = document.getElementById('messages-list');
    const messagesCount = document.getElementById('messages-count');
    const toast = document.getElementById('toast');
    const adminBadge = document.getElementById('admin-badge');
    
    // Check for admin token
    const urlParams = new URLSearchParams(window.location.search);
    let adminToken = urlParams.get('admin') || localStorage.getItem('pictrikit_admin_token');
    let isAdmin = false;
    
    // Store admin token if provided in URL
    if (urlParams.get('admin')) {
      localStorage.setItem('pictrikit_admin_token', urlParams.get('admin'));
      // Clean URL
      window.history.replaceState({}, '', window.location.pathname);
    }
    
    // Generate random username
    function generateUsername() {
      const adj = ['Happy', 'Swift', 'Clever', 'Bright', 'Cool', 'Quick', 'Smart', 'Calm', 'Bold', 'Kind'];
      const noun = ['Panda', 'Eagle', 'Tiger', 'Fox', 'Wolf', 'Bear', 'Hawk', 'Lion', 'Owl', 'Deer'];
      return adj[Math.floor(Math.random() * adj.length)] + noun[Math.floor(Math.random() * noun.length)] + Math.floor(Math.random() * 1000);
    }
    
    // Get or create user ID
    function getUserId() {
      let id = localStorage.getItem('pictrikit_user_id');
      if (!id) {
        id = generateUsername();
        localStorage.setItem('pictrikit_user_id', id);
      }
      return id;
    }
    
    // Show toast
    function showToast(msg, type = 'success') {
      toast.textContent = msg;
      toast.className = 'toast show' + (type === 'error' ? ' error' : '');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    // Format date safely
    function formatDate(ts) {
      if (!ts) return '';
      try {
        const d = new Date(ts);
        if (isNaN(d.getTime())) return '';
        const now = new Date();
        const diff = now - d;
        if (diff < 60000) return 'Just now';
        if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
        if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
        if (diff < 604800000) return Math.floor(diff / 86400000) + 'd ago';
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      } catch (e) {
        return '';
      }
    }
    
    // Get initials
    function getInitials(name) {
      return name.slice(0, 2).toUpperCase();
    }
    
    // Escape HTML
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
    
    // Admin: Delete feedback
    async function deleteFeedback(id) {
      if (!confirm('Delete this message?')) return;
      
      try {
        const res = await fetch('/api/feedback', {
          method: 'DELETE',
          headers: { 
            'Content-Type': 'application/json',
            'X-Admin-Token': adminToken
          },
          body: JSON.stringify({ feedbackId: id })
        });
        
        if (res.ok) {
          showToast('Message deleted');
          loadMessages();
        } else {
          showToast('Delete failed', 'error');
        }
      } catch (e) {
        showToast('Delete failed', 'error');
      }
    }
    
    // Admin: Reply to feedback
    async function replyFeedback(id, reply) {
      try {
        const res = await fetch('/api/feedback', {
          method: 'PUT',
          headers: { 
            'Content-Type': 'application/json',
            'X-Admin-Token': adminToken
          },
          body: JSON.stringify({ feedbackId: id, reply })
        });
        
        if (res.ok) {
          showToast(reply ? 'Reply saved' : 'Reply removed');
          loadMessages();
        } else {
          showToast('Reply failed', 'error');
        }
      } catch (e) {
        showToast('Reply failed', 'error');
      }
    }
    
    // Toggle reply form
    function toggleReplyForm(id, currentReply) {
      const existingForm = document.querySelector('.reply-form');
      if (existingForm) existingForm.remove();
      
      const card = document.querySelector(`[data-id="${id}"]`);
      if (!card) return;
      
      const form = document.createElement('div');
      form.className = 'reply-form';
      form.innerHTML = `
        <textarea placeholder="Write your reply...">${escapeHtml(currentReply || '')}</textarea>
        <div class="reply-form-actions">
          <button class="cancel-btn" onclick="this.closest('.reply-form').remove()">Cancel</button>
          <button class="save-btn" onclick="window.saveReply('${id}', this)">Save</button>
        </div>
      `;
      card.appendChild(form);
      form.querySelector('textarea').focus();
    }
    
    // Global function for save reply
    window.saveReply = function(id, btn) {
      const textarea = btn.closest('.reply-form').querySelector('textarea');
      replyFeedback(id, textarea.value.trim());
    };
    
    // Render messages
    function renderMessages(messages) {
      if (!messages || messages.length === 0) {
        messagesList.innerHTML = '<div class="empty-state"><span class="material-icons-round">chat_bubble_outline</span><p>No messages yet. Be the first to share feedback!</p></div>';
        messagesCount.textContent = '';
        return;
      }
      
      const visibleMessages = messages.filter(m => !m.deleted || isAdmin);
      messagesCount.textContent = visibleMessages.length + ' message' + (visibleMessages.length !== 1 ? 's' : '');
      
      messagesList.innerHTML = visibleMessages.map(m => {
        let replyHtml = '';
        if (m.reply) {
          replyHtml = `
            <aside class="reply-card" aria-label="Official response from PictriKit">
              <header class="reply-header">
                <span class="creator-badge" aria-hidden="true">Creator</span>
                <h4 class="reply-name">Official Response from PictriKit Team</h4>
              </header>
              <p class="reply-content">${escapeHtml(m.reply)}</p>
            </aside>
          `;
        }
        
        let adminHtml = '';
        if (isAdmin) {
          adminHtml = `
            <div class="admin-actions">
              <button class="admin-btn reply-btn" onclick="window.toggleReply('${m.id}', ${m.reply ? "'" + escapeHtml(m.reply).replace(/'/g, "\\'") + "'" : 'null'})">
                <span class="material-icons-round">reply</span>
                ${m.reply ? 'Edit Reply' : 'Reply'}
              </button>
              <button class="admin-btn delete-btn" onclick="window.deleteFeedback('${m.id}')">
                <span class="material-icons-round">delete</span>
                Delete
              </button>
            </div>
          `;
        }
        
        return `
          <article class="message-card${m.deleted ? ' deleted' : ''}" data-id="${m.id}" aria-label="User feedback">
            <header class="message-header">
              <div class="message-user">
                <div class="user-avatar" aria-hidden="true">${getInitials(m.username || 'AN')}</div>
                <h3 class="user-name">${escapeHtml(m.username || 'Anonymous')}</h3>
                ${m.deleted ? '<span style="color:#dc2626;font-size:0.75rem;">(deleted)</span>' : ''}
              </div>
              <time class="message-time" datetime="${m.created_at || m.timestamp}">${formatDate(m.created_at || m.timestamp)}</time>
            </header>
            <div class="message-body">
              <p class="message-content">${escapeHtml(m.content)}</p>
            </div>
            ${replyHtml}
            ${adminHtml}
          </article>
        `;
      }).join('');
    }
    
    // Global functions for admin actions
    window.deleteFeedback = deleteFeedback;
    window.toggleReply = toggleReplyForm;
    
    // Load messages
    async function loadMessages() {
      try {
        const headers = adminToken ? { 'X-Admin-Token': adminToken } : {};
        const res = await fetch('/api/feedback', { headers });
        const data = await res.json();
        
        isAdmin = data.isAdmin === true;
        if (isAdmin) {
          adminBadge.style.display = 'inline-flex';
        }
        
        renderMessages(data.feedback || []);
      } catch (e) {
        // Fallback to local storage
        const local = JSON.parse(localStorage.getItem('pictrikit_feedback') || '[]');
        renderMessages(local);
      }
    }
    
    // Character count
    input.addEventListener('input', () => {
      charCount.textContent = input.value.length;
    });
    
    // Submit
    submitBtn.addEventListener('click', async () => {
      const content = input.value.trim();
      if (!content || content.length < 3) {
        showToast('Please enter at least 3 characters', 'error');
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';
      
      const feedback = {
        content,
        username: getUserId(),
        timestamp: new Date().toISOString(),
        url: window.location.href,
        userAgent: navigator.userAgent
      };
      
      try {
        const res = await fetch('/api/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(feedback)
        });
        
        const data = await res.json();
        
        if (res.ok) {
          showToast('Thanks for your feedback!');
          input.value = '';
          charCount.textContent = '0';
          loadMessages();
        } else {
          showToast(data.error || 'Failed to send', 'error');
        }
      } catch (e) {
        // Store locally
        const local = JSON.parse(localStorage.getItem('pictrikit_feedback') || '[]');
        local.unshift(feedback);
        localStorage.setItem('pictrikit_feedback', JSON.stringify(local));
        showToast('Feedback saved locally');
        input.value = '';
        charCount.textContent = '0';
        renderMessages(local);
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send Feedback';
    });
    
    // Initial load
    loadMessages();
  })();
  </script>
</body>
</html>